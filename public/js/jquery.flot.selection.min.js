(function(a){function b(j){var o={first:{x:-1,y:-1},second:{x:-1,y:-1},show:false,active:false};var l={};function d(q){if(o.active){j.getPlaceholder().trigger("plotselecting",[f()]);k(q)}}function m(q){if(q.which!=1){return}document.body.focus();if(document.onselectstart!==undefined&&l.onselectstart==null){l.onselectstart=document.onselectstart;document.onselectstart=function(){return false}}if(document.ondrag!==undefined&&l.ondrag==null){l.ondrag=document.ondrag;document.ondrag=function(){return false}}c(o.first,q);o.active=true;a(document).one("mouseup",i)}function i(q){if(document.onselectstart!==undefined){document.onselectstart=l.onselectstart}if(document.ondrag!==undefined){document.ondrag=l.ondrag}o.active=false;k(q);if(e()){h()}else{j.getPlaceholder().trigger("plotunselected",[]);j.getPlaceholder().trigger("plotselecting",[null])}return false}function f(){if(!e()){return null}var s=Math.min(o.first.x,o.second.x),q=Math.max(o.first.x,o.second.x),u=Math.max(o.first.y,o.second.y),t=Math.min(o.first.y,o.second.y);var v={};var w=j.getAxes();if(w.xaxis.used){v.xaxis={from:w.xaxis.c2p(s),to:w.xaxis.c2p(q)}}if(w.x2axis.used){v.x2axis={from:w.x2axis.c2p(s),to:w.x2axis.c2p(q)}}if(w.yaxis.used){v.yaxis={from:w.yaxis.c2p(u),to:w.yaxis.c2p(t)}}if(w.y2axis.used){v.y2axis={from:w.y2axis.c2p(u),to:w.y2axis.c2p(t)}}return v}function h(){var q=f();j.getPlaceholder().trigger("plotselected",[q]);var s=j.getAxes();if(s.xaxis.used&&s.yaxis.used){j.getPlaceholder().trigger("selected",[{x1:q.xaxis.from,y1:q.yaxis.from,x2:q.xaxis.to,y2:q.yaxis.to}])}}function g(r,s,q){return s<r?r:(s>q?q:s)}function c(u,r){var t=j.getOptions();var s=j.getPlaceholder().offset();var q=j.getPlotOffset();u.x=g(0,r.pageX-s.left-q.left,j.width());u.y=g(0,r.pageY-s.top-q.top,j.height());if(t.selection.mode=="y"){u.x=u==o.first?0:j.width()}if(t.selection.mode=="x"){u.y=u==o.first?0:j.height()}}function k(q){if(q.pageX==null){return}c(o.second,q);if(e()){o.show=true;j.triggerRedrawOverlay()}else{p(true)}}function p(q){if(o.show){o.show=false;j.triggerRedrawOverlay();if(!q){j.getPlaceholder().trigger("plotunselected",[])}}}function n(r,q){var t,s,u=j.getAxes();var v=j.getOptions();if(v.selection.mode=="y"){o.first.x=0;o.second.x=j.width()}else{t=r.xaxis?u.xaxis:(r.x2axis?u.x2axis:u.xaxis);s=r.xaxis||r.x2axis||{from:r.x1,to:r.x2};o.first.x=t.p2c(Math.min(s.from,s.to));o.second.x=t.p2c(Math.max(s.from,s.to))}if(v.selection.mode=="x"){o.first.y=0;o.second.y=j.height()}else{t=r.yaxis?u.yaxis:(r.y2axis?u.y2axis:u.yaxis);s=r.yaxis||r.y2axis||{from:r.y1,to:r.y2};o.first.y=t.p2c(Math.min(s.from,s.to));o.second.y=t.p2c(Math.max(s.from,s.to))}o.show=true;j.triggerRedrawOverlay();if(!q){h()}}function e(){var q=5;return Math.abs(o.second.x-o.first.x)>=q&&Math.abs(o.second.y-o.first.y)>=q}j.clearSelection=p;j.setSelection=n;j.getSelection=f;j.hooks.bindEvents.push(function(r,q){var s=r.getOptions();if(s.selection.mode!=null){q.mousemove(d)}if(s.selection.mode!=null){q.mousedown(m)}});j.hooks.drawOverlay.push(function(t,B){if(o.show&&e()){var r=t.getPlotOffset();var q=t.getOptions();B.save();B.translate(r.left,r.top);var u=a.color.parse(q.selection.color);B.strokeStyle=u.scale("a",0.8).toString();B.lineWidth=1;B.lineJoin="round";B.fillStyle=u.scale("a",0.4).toString();var z=Math.min(o.first.x,o.second.x),v=Math.min(o.first.y,o.second.y),A=Math.abs(o.second.x-o.first.x),s=Math.abs(o.second.y-o.first.y);B.fillRect(z,v,A,s);B.strokeRect(z,v,A,s);B.restore()}})}a.plot.plugins.push({init:b,options:{selection:{mode:null,color:"#e8cfac"}},name:"selection",version:"1.0"})})(jQuery);